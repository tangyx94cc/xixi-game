<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>婚礼宾客座位安排表</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            .print-break-before { break-before: page; }
            body { background-color: white; }
        }
        .vertical-rl { writing-mode: vertical-rl; }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 font-sans">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const Icons = {
            Layout: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="1"/><rect width="7" height="7" x="3" y="3"/><rect width="7" height="7" x="14" y="3"/><rect width="7" height="7" x="14" y="14"/><rect width="7" height="7" x="3" y="14"/></svg>,
            Printer: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></svg>,
            RotateCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>,
            Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
            ArrowUp: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 12 7-7 7 7"/><path d="M12 19V5"/></svg>,
            Database: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
            Download: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>,
            Upload: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
        };
        const FLOOR_DATA = {
            floor1: { id: 1, name: "一楼 (1F)", description: "迎宾区 & 茶歇走廊", tables: [{ id: 't1-1', name: '包间 101', type: 'round', isPrivate: true, side: 'left' }, { id: 't1-2', name: '包间 102', type: 'round', isPrivate: true, side: 'right' }] },
            floor2: { id: 2, name: "二楼 (2F)", description: "宴会主厅", longTables: [{ id: 't2-long-1', name: '长条桌 A', type: 'long', isPrivate: false }, { id: 't2-long-2', name: '长条桌 B', type: 'long', isPrivate: false }], roundTables: [{ id: 't2-1', name: '主厅 01', type: 'round', isPrivate: false }, { id: 't2-2', name: '主厅 02', type: 'round', isPrivate: false }, { id: 't2-3', name: '主厅 03', type: 'round', isPrivate: false }, { id: 't2-4', name: '主厅 04', type: 'round', isPrivate: false }], privateRooms: [{ id: 't2-p1', name: '包间 201', type: 'round', isPrivate: true }, { id: 't2-p2', name: '包间 202', type: 'round', isPrivate: true }] },
            floor3: { id: 3, name: "三楼 (3F)", description: "贵宾包间层", tables: [{ id: 't3-1', name: '包间 301', type: 'round', isPrivate: true }, { id: 't3-2', name: '包间 302', type: 'round', isPrivate: true }, { id: 't3-3', name: '包间 303', type: 'round', isPrivate: true }, { id: 't3-4', name: '包间 305', type: 'round', isPrivate: true }] }
        };

        function App() {
            const [guestData, setGuestData] = useState({});
            const [totalGuests, setTotalGuests] = useState(0);
            const [showModal, setShowModal] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('wedding_seating_db');
                if (saved) {
                    try {
                        setGuestData(JSON.parse(saved));
                    } catch (e) {
                        // ignore invalid local data
                    }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('wedding_seating_db', JSON.stringify(guestData));
                setTotalGuests(Object.values(guestData).filter(n => n && n.trim()).length);
            }, [guestData]);

            const handleNameChange = (id, idx, val) => setGuestData(prev => ({ ...prev, [`${id}-${idx}`]: val }));

            const handleExport = () => {
                const a = document.createElement('a');
                a.href = URL.createObjectURL(new Blob([JSON.stringify(guestData, null, 2)], { type: "application/json" }));
                a.download = `座位表备份_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
            };

            const handleImport = (e) => {
                const r = new FileReader();
                r.onload = (ev) => {
                    try {
                        setGuestData(JSON.parse(ev.target.result));
                        alert('数据导入成功！');
                        setShowModal(false);
                    } catch (err) {
                        alert('文件格式错误');
                    }
                };
                if (e.target.files[0]) {
                    r.readAsText(e.target.files[0]);
                }
            };

            const handleClear = () => {
                if (confirm('确定要清空所有数据吗？')) {
                    setGuestData({});
                }
            };

            return (
                <div className="min-h-screen pb-20">
                    <header className="bg-white border-b border-stone-200 sticky top-0 z-50 no-print shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div>
                                <h1 className="text-2xl font-serif text-rose-900 flex items-center gap-2"><Icons.Layout /> 婚礼座位表</h1>
                                <p className="text-sm text-stone-500 mt-1">已安排 {totalGuests} 位宾客</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => setShowModal(true)} className="flex items-center gap-2 px-3 py-2 bg-stone-100 text-stone-700 rounded hover:bg-stone-200 text-sm"><Icons.Database /> 备份/恢复</button>
                                <button onClick={handleClear} className="flex items-center gap-2 px-3 py-2 text-stone-500 hover:text-red-600 text-sm"><Icons.RotateCcw /> 清空</button>
                                <button onClick={() => window.print()} className="flex items-center gap-2 px-4 py-2 bg-rose-900 text-white rounded hover:bg-rose-800 shadow-md text-sm"><Icons.Printer /> 打印</button>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-[1600px] mx-auto px-4 py-8 space-y-12">
                        <Section title={FLOOR_DATA.floor1.name} desc={FLOOR_DATA.floor1.description}>
                            <div className="flex flex-col md:flex-row justify-center items-center gap-12 mt-8 min-h-[300px]">
                                <RoundTable table={FLOOR_DATA.floor1.tables[0]} data={guestData} onChange={handleNameChange} />
                                <div className="w-48 h-80 flex flex-col items-center justify-center border-x-2 border-dashed border-stone-300 bg-stone-50 rounded-lg px-4 gap-4 no-print">
                                    <div className="text-stone-400 font-serif text-lg tracking-widest vertical-rl">茶歇走廊</div>
                                    <div className="text-amber-600"><Icons.Coffee /></div>
                                    <div className="w-full h-px bg-stone-300"></div>
                                    <div className="flex flex-col items-center gap-1 text-stone-400 text-xs"><Icons.ArrowUp /> 通往二楼</div>
                                </div>
                                <RoundTable table={FLOOR_DATA.floor1.tables[1]} data={guestData} onChange={handleNameChange} />
                            </div>
                        </Section>

                        <Section title={FLOOR_DATA.floor2.name} desc={FLOOR_DATA.floor2.description}>
                            <div className="flex flex-col gap-12 mt-8">
                                <div className="flex justify-center gap-8 md:gap-24 flex-wrap">
                                    {FLOOR_DATA.floor2.longTables.map(t => <LongTable key={t.id} table={t} data={guestData} onChange={handleNameChange} />)}
                                </div>
                                <div className="flex justify-center gap-8 flex-wrap">
                                    {FLOOR_DATA.floor2.roundTables.map(t => <RoundTable key={t.id} table={t} data={guestData} onChange={handleNameChange} />)}
                                </div>
                                <div className="flex justify-between items-center px-4 md:px-12">
                                    <div className="bg-amber-50/50 p-4 rounded-3xl border border-amber-100"><RoundTable table={FLOOR_DATA.floor2.privateRooms[0]} data={guestData} onChange={handleNameChange} /></div>
                                    <div className="hidden md:flex flex-col items-center text-stone-300 no-print"><div className="w-32 h-32 border-2 border-stone-100 rounded-full flex items-center justify-center text-xs">舞台区域</div></div>
                                    <div className="bg-amber-50/50 p-4 rounded-3xl border border-amber-100"><RoundTable table={FLOOR_DATA.floor2.privateRooms[1]} data={guestData} onChange={handleNameChange} /></div>
                                </div>
                            </div>
                        </Section>

                        <Section title={FLOOR_DATA.floor3.name} desc={FLOOR_DATA.floor3.description}>
                            <div className="flex flex-wrap justify-center xl:justify-between gap-8 mt-8 px-4">
                                {FLOOR_DATA.floor3.tables.map(t => <RoundTable key={t.id} table={t} data={guestData} onChange={handleNameChange} />)}
                            </div>
                        </Section>
                    </main>

                    {showModal && (
                        <div className="fixed inset-0 bg-black/50 z-[100] flex items-center justify-center p-4">
                            <div className="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-lg font-bold">备份与恢复</h3>
                                    <button onClick={() => setShowModal(false)}><Icons.X /></button>
                                </div>
                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">1. 下载数据 (分享给他人)</label>
                                        <button onClick={handleExport} className="w-full py-2 bg-blue-600 text-white rounded hover:bg-blue-700 flex justify-center gap-2 items-center"><Icons.Download /> 下载 JSON 文件</button>
                                    </div>
                                    <div className="h-px bg-stone-200"></div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2">2. 导入数据 (读取他人数据)</label>
                                        <div className="relative border-2 border-dashed border-stone-300 rounded-lg p-4 text-center hover:bg-stone-50">
                                            <input type="file" accept=".json" onChange={handleImport} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                                            <div className="flex flex-col items-center text-stone-500 gap-2"><Icons.Upload /><span className="text-sm">点击选择文件上传</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function Section({ title, desc, children }) {
            return (
                <section className="bg-white rounded-2xl shadow-sm border border-stone-200 p-8 print:border-none print:shadow-none print:p-0 print-break-before">
                    <div className="flex flex-col items-center border-b border-rose-100 pb-4 mb-6">
                        <h2 className="text-2xl md:text-3xl font-serif text-rose-950">{title}</h2>
                        <span className="text-stone-500 font-light mt-1">{desc}</span>
                    </div>
                    {children}
                </section>
            );
        }

        function RoundTable({ table, data, onChange }) {
            const radius = 130;
            const centerX = 160;
            const centerY = 160;

            return (
                <div className="relative w-[320px] h-[320px] print:w-[280px] print:h-[280px] break-inside-avoid">
                    <div className={`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-36 h-36 rounded-full flex flex-col items-center justify-center text-center p-2 z-10 shadow-lg border-4 ${table.isPrivate ? 'bg-amber-50 border-amber-200 text-amber-900' : 'bg-white border-rose-100 text-rose-900'}`}>
                        <span className="font-serif font-bold text-lg leading-tight">{table.name}</span>
                    </div>
                    {Array.from({ length: 10 }).map((_, i) => {
                        const rad = ((i * 36) - 90) * Math.PI / 180;
                        return (
                            <div key={i} className="absolute -translate-x-1/2 -translate-y-1/2 flex flex-col items-center gap-1 scale-90 print:scale-75" style={{ left: centerX + radius * Math.cos(rad), top: centerY + radius * Math.sin(rad) }}>
                                <div className={`w-8 h-8 rounded-full shadow-sm border flex items-center justify-center text-xs font-bold ${data[`${table.id}-${i}`] ? 'bg-rose-500 border-rose-600 text-white' : 'bg-white border-stone-300'}`}>{i + 1}</div>
                                <input type="text" value={data[`${table.id}-${i}`] || ''} onChange={e => onChange(table.id, i, e.target.value)} placeholder="宾客" className="w-20 text-center bg-white/90 border-b border-stone-300 focus:border-rose-500 outline-none text-xs py-0.5" />
                            </div>
                        );
                    })}
                </div>
            );
        }

        function LongTable({ table, data, onChange }) {
            return (
                <div className="w-[380px] flex flex-col gap-2 break-inside-avoid my-auto">
                    <div className="flex justify-between px-4">{[0,1,2,3,4].map(i => <Seat key={i} idx={i} tableId={table.id} data={data} onChange={onChange} pos="top" />)}</div>
                    <div className={`h-20 w-full rounded-lg border-2 flex items-center justify-center shadow-md ${table.isPrivate ? 'bg-amber-50 border-amber-200' : 'bg-white border-stone-200'}`}><div className="text-center"><h3 className="font-serif font-bold text-stone-800">{table.name}</h3></div></div>
                    <div className="flex justify-between px-4">{[5,6,7,8,9].map(i => <Seat key={i} idx={i} tableId={table.id} data={data} onChange={onChange} pos="bottom" />)}</div>
                </div>
            );
        }

        function Seat({ idx, tableId, data, onChange, pos }) {
            return (
                <div className={`flex flex-col items-center gap-1 ${pos === 'bottom' ? 'flex-col-reverse' : ''}`}>
                    <div className={`w-8 h-7 rounded-sm border shadow-sm flex items-center justify-center text-[10px] font-bold ${data[`${tableId}-${idx}`] ? 'bg-blue-500 border-blue-600 text-white' : 'bg-white border-stone-300'}`}>{idx + 1}</div>
                    <input type="text" value={data[`${tableId}-${idx}`] || ''} onChange={e => onChange(tableId, idx, e.target.value)} placeholder="姓名" className="w-16 text-center text-xs border border-stone-200 rounded py-1 px-0.5 focus:border-blue-500 outline-none" />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
